<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="styleh.css">
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue&family=Roboto&display=swap" rel="stylesheet">
    <title>Common library</title>
</head>
<body>
    <header>
        <a href="search.html">Search</a>
        <a href="add.html">Add</a>
        <a href="index.html"><img src="logo.png" width="60px" alt="Logo"></a>
        <a href="about.html">About us</a>
        <a href="news.html">News</a>
        <p id="profile">
          <a href="login.html">Login</a>/<a href="register.html">Register</a>
        </p>
      </header>
      
      
      
    <main id="content">
        <div id="jamb">
            <img id="jpic" src='jamb.jpg'> 
            <div id="text">
                <p id="slogan">Building community.</p>
                <p id="slogan">Inspiring readers.</p>
                <p id="slogan">Expanding book access.</p>
            </div>
        </div>
        <div class="stickcont">
            <div id="stick">
            </div>
        </div>

        <div id="new">
        <h3>Several new books</h3>
        </div>

        <div id="newbooks">
              </div>
        <div class="stickcont">
            <div id="stick">
            </div>
        </div>
        <div id="search_form">
            <form method="GET" id="search">
                          <input name="search"> 
                <button type="submit" onclick="searchBook">Search a book</button>
            </form>
         </div>
         <div class="stickcont">
            <div id="stick">
            </div>
        </div>
        <div id="searchRes">
            
        </div>
    </main>
    <script>

let urls = {
	createUser:'http://127.0.0.1:8000/api/v1/auth/users/',
	loginUser:'http://127.0.0.1:8000/api/v1/auth/token/login/',
	logoutUser: 'http://127.0.0.1:8000/api/v1/auth/token/logout/',

	getAllBooks:'http://127.0.0.1:8000/api/v1/book/',
	addBook:'http://127.0.0.1:8000/api/v1/book/',
}

async function requestGET(url, options={}){
	const param = new URLSearchParams();
	for (p in options){
		param.append(p,options[p])
	}
	console.log('GET запрос:', url + '?' + param);
	try {
		res= await fetch(url + '?' + param);
		console.log(res);
		if (!res.ok){
			return("Error in Get Request(dima)");
		} else {
			let res_Js = res.json();
			return res_Js;
		}
	} catch (error) {
		
	}
}

    function searchBook (event) {
        event.preventDefault();
        let form=document.querySelector('#search');
        let question=event.value;
        fetch ('https//?' + question)
        .then(res => res.json())
            .then(data => {console.log(data.books);
                data.books.foreEach((id)=> {
                console.log(books)
                html=`
                    <h3> Title: ${books.title} </h3>
                    <h4> Author:${books.author} </h4>
                    <h4> Comments:${books.comments}</h4>
                    <h4> Owner: ${books.owner}</h4>
                    <h4> Owner: ${books.owner.ad}</h4>`
                                        }
                                    )

                            })
                }



//func to get books from base
async function getAllBooks(e){
    e.preventDefault();
    //to get all books in our database
	let res = await requestGET('http://127.0.0.1:8000/api/v1/book/');
	// console.log(res);
	let listDiv = document.querySelector('#newbooks')
	listDiv.textContent='';
	for (book of res){
		let ul = document.createElement('ul');
		for (t in book){
			let li = document.createElement('li');
			li.innerHTML = t +": <b>" + book[t] + '</b>'
			ul.appendChild(li);
		}
		listDiv.appendChild(ul);
		let hr = document.createElement('hr');
		listDiv.appendChild(hr);
	}
}

window.addEventListener("load", getAllBooks)

    </script>
</body>
</html>